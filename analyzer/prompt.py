# analyzer/prompts.py
"""AI分析提示词管理"""

# 文章分析主提示词
ARTICLE_ANALYSIS_PROMPT = """
请深入分析以下{institution}在{date}发布的债券市场观点文章，提取详细信息：

文章内容：{content}

请按以下要求详细分析：

1. 基本面及通胀观点
- 经济数据分析（GDP、PMI、工业增加值等具体数据）
- 通胀趋势判断（CPI、PPI数据及趋势）
- 关键经济指标的同比/环比变化
- 对经济周期的判断

2. 资金面观点
- 具体资金利率水平（DR007、R007等）
- 流动性缺口分析
- 央行操作规模（逆回购、MLF等具体数据）
- 银行间市场资金供需状况

3. 货币及财政政策观点
- 政策利率变化（LPR、MLF利率等）
- 准备金率调整
- 财政支出节奏
- 政府债券发行计划及影响

4. 机构行为观点
- 各类机构配置偏好
- 具体持仓变化数据
- 机构久期策略
- 资金流向分析

5. 海外及其他观点
- 美债收益率走势
- 中美利差分析
- 汇率影响
- 地缘政治等其他因素

6. 文章类型分类（可多选）
- 利率债分析
- 信用债分析
- 资金市场分析
- 宏观经济分析
- 政策解读
- 市场策略

7. 投资策略建议
- 具体的投资品种推荐
- 久期和仓位建议
- 风险提示

8. 收益率预测
- 如果文章明确提到10Y/5Y国债收益率预测，请准确提取
- 如果没有明确预测，根据文章观点推断方向（上行/下行/震荡）
- 如果完全无法推断，请标注"文章未涉及"

评分要求（1-10分）：
- 数据支撑充分度（是否有具体数据支持观点）：权重30%
- 逻辑完整性（分析框架是否完整）：权重20%
- 策略可操作性（对商业银行投资的指导价值）：权重30%
- 观点独特性（是否有差异化见解）：权重20%

请严格按照以下JSON格式返回：
{{
    "基本面及通胀": "详细分析内容，包含具体数据",
    "资金面": "详细分析内容，包含具体利率水平",
    "货币及财政政策": "详细政策分析，包含政策变化",
    "机构行为": "详细机构分析，包含配置数据",
    "海外及其他": "详细海外分析",
    "文章类型": ["利率债分析", "宏观经济分析"],
    "整体观点": "核心观点总结",
    "投资策略": "具体可操作的策略建议",
    "10Y国债收益率预测": {{
        "方向": "上行/下行/震荡/文章未涉及",
        "区间": "2.30%-2.40%或文章未涉及",
        "概率": "70%或文章未涉及",
        "理由": "基于文章分析的预测理由"
    }},
    "5Y国债收益率预测": {{
        "方向": "上行/下行/震荡/文章未涉及",
        "区间": "2.10%-2.20%或文章未涉及",
        "概率": "60%或文章未涉及",
        "理由": "基于文章分析的预测理由"
    }},
    "重要性评分": 7,
    "评分细项": {{
        "数据支撑": 8,
        "逻辑完整": 7,
        "策略价值": 6,
        "观点独特": 7
    }},
    "评分理由": "详细说明评分理由，特别是对商业银行投资的价值"
}}
"""

# TODO 3.1: 收益率预测聚合统计
YIELD_PREDICTION_AGGREGATION_PROMPT = """
基于以下各机构的债券收益率预测观点，请进行聚合统计分析：

机构预测数据：
{predictions_data}

请分析并返回以下内容：

1. 10Y国债收益率预测统计
   - 看涨（上行）机构：
     * 数量：X家
     * 占比：XX%
     * 主要机构：[列表]
     * 平均预测区间：X.XX%-X.XX%
     * 主要理由汇总
   - 看跌（下行）机构：
     * 数量：X家
     * 占比：XX%
     * 主要机构：[列表]
     * 平均预测区间：X.XX%-X.XX%
     * 主要理由汇总
   - 中性（震荡）机构：
     * 数量：X家
     * 占比：XX%
     * 主要机构：[列表]
     * 预测区间：X.XX%-X.XX%
   - 市场共识度：高/中/低（基于观点分散程度）

2. 5Y国债收益率预测统计（格式同上）

3. 主要分歧点
   - 分歧因素1：[具体说明]
   - 分歧因素2：[具体说明]
   - 分歧因素3：[具体说明]

4. 综合预测
   - 10Y国债：根据权重和评分，预测为XX，区间X.XX%-X.XX%
   - 5Y国债：根据权重和评分，预测为XX，区间X.XX%-X.XX%

请用JSON格式返回结果。
"""

# TODO 3.2 & 3.3: 增强评分系统
ENHANCED_SCORING_PROMPT = """
请对以下债券市场分析文章进行专业评分：

文章基本信息：
- 机构：{institution}
- 发布日期：{date}
- 阅读量：{read_count}
- 文章长度：{content_length}字

文章内容摘要：
{content_summary}

评分维度说明：
1. 数据支撑度（25%）
   - 是否引用具体经济数据
   - 数据的时效性和权威性
   - 数据与观点的关联性

2. 逻辑完整性（20%）
   - 分析框架是否完整
   - 论证过程是否严密
   - 结论是否有充分支撑

3. 策略价值（25%）
   - 对投资决策的指导意义
   - 策略的可操作性
   - 风险提示的完整性

4. 观点独特性（15%）
   - 是否有差异化见解
   - 观点的前瞻性
   - 分析角度的创新性

5. 市场影响力（15%）
   - 基于阅读量（权重60%）
   - 基于机构权威性（权重40%）

评分标准：
- 9-10分：极具价值，观点独特，数据翔实，逻辑严密
- 7-8分：有价值，观点清晰，有数据支撑
- 5-6分：一般价值，观点常规，数据一般
- 3-4分：价值较低，观点模糊，缺乏数据
- 1-2分：几乎无价值

请返回JSON格式：
{{
    "综合评分": X.X,
    "维度评分": {{
        "数据支撑": X,
        "逻辑完整": X,
        "策略价值": X,
        "观点独特": X,
        "市场影响": X
    }},
    "评分理由": "详细说明各维度评分理由",
    "核心亮点": ["亮点1", "亮点2", "亮点3"],
    "不足之处": ["不足1", "不足2"],
    "区分度说明": "说明为什么给出这个分数而不是7分"
}}
"""

# TODO 3.4: 主要观点NLP提炼
KEY_OPINIONS_EXTRACTION_PROMPT = """
请从以下多篇债券市场分析文章中，使用NLP技术提取和提炼主要观点：

文章列表（按重要性排序）：
{articles_summary}

分析要求：
1. 观点聚类分析
   - 识别相似观点并归类
   - 统计每类观点的出现频率
   - 标注持有该观点的主要机构

2. 核心观点提炼（控制在500字内）
   - 利率走势核心观点（150字）
   - 政策预期核心观点（150字）
   - 市场情绪核心观点（100字）
   - 投资策略核心观点（100字）

3. 观点差异化分析
   - 主流观点 vs 非主流观点
   - 观点演变趋势（如果有时间序列）
   - 关键分歧点

4. 情感倾向分析
   - 整体市场情绪：乐观/中性/悲观
   - 各维度情绪分布
   - 情绪强度评分（1-10）

5. 关键词提取
   - 高频关键词Top10
   - 新增关键词（相比历史）
   - 关键词语义网络

请返回JSON格式，注意控制总体篇幅。
"""

# 收益率预测提示词
YIELD_FORECAST_PROMPT = """
基于以下各机构的国债收益率预测，生成综合预测：

10Y国债明确预测：
{explicit_10y}

10Y国债方向预测：
{directional_10y}

5Y国债明确预测：
{explicit_5y}

5Y国债方向预测：
{directional_5y}

请基于以上信息生成合理的综合预测：
1. 如果有明确的区间预测，以多数机构的预测为主
2. 如果只有方向性预测，结合当前市场水平给出合理区间
3. 注意当前10Y国债收益率约在xx.xx%-xx.xx%区间，5Y约在xx.xx%-xx.xx%区间
4. 格式：根据X家机构观点，XX%概率下，10Y国债收益率将XX至X.XX%-X.XX%；XX%概率下，5Y国债收益率将XX至X.XX%-X.XX%。
"""

# 市场总结报告提示词
SUMMARY_REPORT_PROMPT = """
根据以下债券市场观点，生成一份500字左右的利率债市场分析报告：

文章类型分布：{article_types}

基本面及通胀详细观点：
{fundamental_views}

资金面详细观点：
{liquidity_views}

货币及财政政策详细观点：
{policy_views}

机构行为详细观点：
{institutional_views}

海外及其他详细观点：
{overseas_views}

收益率预测：{yield_forecast}

要求：
1. 总长度严格控制在500字左右
2. 必须包含具体的数据支撑
3. 结构清晰：先总述，然后分1）2）3）4）5）6）阐述各维度观点
4. 最后给出具体的投资策略建议和收益率预测
5. 语言专业、逻辑清晰、观点明确
"""
